<!DOCTYPE html>
<html>
  <head>
    <style>
       
      html {
        overflow: hidden;
      }   
      body {
        background-color: #000000;
        color: #ffffff;
        overflow: hidden;
      }

      #div_board {
        display: inline-block;
      }
      #div_controls {
        float: right;
        width: 45vw;
      }
      #div_buttons {
        margin-right: 5vw;
      }

      #table_mainBoard * {
        border: solid #ffffff 0.5px;
        user-select: none;
      }
      #table_mainBoard td {
        width: 10vw;
        height: 12vh;
        text-align: center;
        font-size: 600%;
      }
      #table_status, #table_status * {
        border: solid #ffffff 0.5px;
        border-collapse: collapse;
      }
      #table_status td {
        padding: 2%;
        width: 20vw;
        height: 3vh;
      }
      #table_status td:nth-child(even) {
        text-align: center;
      }

    </style>
  </head>
  <body>  
    <title>Unstoppapoe Nguyen</title>  
    <div id="div_main">
          <div id="div_board">
            <table id="table_mainBoard">
              <tbody>
                <tr><td class="boardSpace"></td><td class="boardSpace"></td><td class="boardSpace"></td></tr>
                <tr><td class="boardSpace"></td><td class="boardSpace"></td><td class="boardSpace"></td></tr>
                <tr><td class="boardSpace"></td><td class="boardSpace"></td><td class="boardSpace"></td></tr>
              </tbody>
            </table>
          </div>
          <div id="div_controls">
            <div id="div_status">
              <table id="table_status">
                <tbody>
                  <tr><td id="cell_1_name"></td><td id="cell_1_value"></td><td id="cell_2_name"></td><td id="cell_2_value"></td></tr>
                  <tr><td id="cell_3_name"></td><td id="cell_3_value"></td><td id="cell_4_name"></td><td id="cell_4_value"></td></tr>
                  <tr><td id="cell_5_name"></td><td id="cell_5_value"></td><td id="cell_6_name"></td><td id="cell_6_value"></td></tr>
                  <tr><td id="cell_7_name"></td><td id="cell_7_value"></td><td id="cell_8_name"></td><td id="cell_8_value"></td></tr>
                  <tr><td id="cell_9_name"></td><td id="cell_9_value"></td><td id="cell_10_name"></td><td id="cell_10_value"></td></tr>
                  <tr><td id="cell_11_name"></td><td id="cell_11_value"></td><td id="cell_12_name"></td><td id="cell_12_value"></td></tr>
                </tbody>
              </table>
            </div>
            <div id="div_buttons"><br/>
              <button id="btn_GO" onclick="goFunc();">GO</button><select id="sel_options"></select><br/>
              <button id="btn_getMatch" onclick="getMatch(1);">Get Match</button>
              <button id="btn_getMatches" onclick="getMatches(1);">Get Matches</button>
              <button id="btn_updateMatch" onclick="updateMatch();">Update Match</button><br/>
              <button id="btn_getGame" onclick="getGame(1);">Get Game</button>
              <button id="btn_getGames" onclick="getGames(1);">Get Games</button>
              <button id="btn_updateGame" onclick="updateGame();">Update Game</button>
            </div>
          </div>
    </div>
    <script>

      let currentMatch;
      let currentGame;
      let gotMatches = false;
      let gotGames = false;

      document.body.addEventListener("click", e => {
        switch(e.target.className){
          case "boardSpace":
            if(e.target.innerText === "") e.target.innerText = "X";
            else if(e.target.innerText === "X") e.target.innerText = "O";
            else e.target.innerText = ""; 
            break;
        }
      });

      function clearStatusTable(){
        document.querySelectorAll("#table_status td").forEach(td => {
          td.innerText = "";
        });
      }

      function fillBoard(board){
        for(let i = 0; i < 9; i++){
          let piece = "";
          (board[i] === "-") ? piece = "" : piece = board[i];
          document.querySelector(`#table_mainBoard tr:nth-child(${Math.floor(i / 3) + 1}) > td:nth-child(${(i % 3) + 1})`).innerText = piece;
        }
      }

      async function goFunc(){
        
      }

      async function getMatch(match_id){
        if(typeof ignoreMatches === "undefined"){
          if(gotMatches) match_id = +document.querySelector("#sel_options").value;
        }
        clearStatusTable();
        let res = await fetch("getMatch", {
          method: "PUT",
          headers: {
          "Content-Type": "application/json",
          },
          body: JSON.stringify(match_id),
        });
        let matchInfo = await res.json();
        document.querySelector("#cell_1_name").innerText = "match_id";
        document.querySelector("#cell_1_value").innerText = matchInfo.match_id;
        document.querySelector("#cell_2_name").innerText = "match_status";
        document.querySelector("#cell_2_value").innerText = matchInfo.match_status;
        document.querySelector("#cell_3_name").innerText = "match_winner";
        document.querySelector("#cell_3_value").innerText = matchInfo.match_winner;
        document.querySelector("#cell_4_name").innerText = "match_exp";
        document.querySelector("#cell_4_value").innerText = matchInfo.match_exp;
        document.querySelector("#cell_5_name").innerText = "player_x_id";
        document.querySelector("#cell_5_value").innerText = matchInfo.player_x_id;
        document.querySelector("#cell_6_name").innerText = "player_x_score";
        document.querySelector("#cell_6_value").innerText = matchInfo.player_x_score;
        document.querySelector("#cell_7_name").innerText = "player_o_id";
        document.querySelector("#cell_7_value").innerText = matchInfo.player_o_id;
        document.querySelector("#cell_8_name").innerText = "player_o_score";
        document.querySelector("#cell_8_value").innerText = matchInfo.player_o_score;
        document.querySelector("#cell_9_name").innerText = "match_updateToken";
        document.querySelector("#cell_9_value").innerText = matchInfo.match_updateToken;
        document.querySelector("#cell_10_name").innerText = "match_turn";
        document.querySelector("#cell_10_value").innerText = matchInfo.match_turn;
        document.querySelector("#cell_11_name").innerText = "match_lastMoveGame";
        document.querySelector("#cell_11_value").innerText = matchInfo.match_lastMoveGame;
        document.querySelector("#cell_12_name").innerText = "match_type";
        document.querySelector("#cell_12_value").innerText = matchInfo.match_type;
        currentMatch = matchInfo;
        return matchInfo;
      }

      async function getMatches(player_id){
        gotGames = false;
        document.querySelector("#sel_options").innerHTML = "";
        let res = await fetch("getMatches", {
          method: "PUT",
          headers: {
          "Content-Type": "application/json",
          },
          body: JSON.stringify(player_id),
        });
        let matches = await res.json();
        if(!Array.isArray(matches)) matches = [matches];
        let opStr = "";
        for(let match of matches){
          opStr += `<option>${match.match_id}</option>`;
        }
        document.querySelector("#sel_options").innerHTML = opStr;
        gotMatches = true;
        return matches;
      }

      async function updateMatch(){
        let res = await fetch("updateMatch", {
          method: "PUT",
          headers: {
          "Content-Type": "application/json",
          },
          body: JSON.stringify(currentMatch),
        });
        let updateResult = await res.json();
        return updateResult;
      }

      async function getGame(game_id, ignoreGames){
        if(typeof ignoreGames === "undefined"){
          if(gotGames) game_id = +document.querySelector("#sel_options").value;
        }
        clearStatusTable();
        let res = await fetch("getGame", {
          method: "PUT",
          headers: {
          "Content-Type": "application/json",
          },
          body: JSON.stringify(game_id),
        });
        let gameInfo = await res.json();
        document.querySelector("#cell_1_name").innerText = "game_id";
        document.querySelector("#cell_1_value").innerText = gameInfo.game_id;
        document.querySelector("#cell_2_name").innerText = "match_id";
        document.querySelector("#cell_2_value").innerText = gameInfo.match_id;
        document.querySelector("#cell_3_name").innerText = "board_current";
        document.querySelector("#cell_3_value").innerText = gameInfo.board_current;
        document.querySelector("#cell_4_name").innerText = "board_prev";
        document.querySelector("#cell_4_value").innerText = gameInfo.board_prev;
        document.querySelector("#cell_5_name").innerText = "game_status";
        document.querySelector("#cell_5_value").innerText = gameInfo.game_status;
        document.querySelector("#cell_6_name").innerText = "game_winner";
        document.querySelector("#cell_6_value").innerText = gameInfo.game_winner;
        fillBoard(gameInfo.board_current);
        currentGame = gameInfo;
        return gameInfo;
      }

      async function getGames(match_id, ignoreMatches){
        gotMatches = false;
        if(typeof ignoreMatches === "undefined"){
          if(gotGames) match_id = +document.querySelector("#sel_options").value;
        }
        document.querySelector("#sel_options").innerHTML = "";
        let res = await fetch("getGames", {
          method: "PUT",
          headers: {
          "Content-Type": "application/json",
          },
          body: JSON.stringify(match_id),
        });
        let games = await res.json();
        if(!Array.isArray(games)) games = [games];
        let opStr = "";
        for(let game of games){
          opStr += `<option>${game.game_id}</option>`;
        }
        document.querySelector("#sel_options").innerHTML = opStr;
        gotGames = true;
        return games;
      }

      async function updateGame(){
        let res = await fetch("updateGame", {
          method: "PUT",
          headers: {
          "Content-Type": "application/json",
          },
          body: JSON.stringify(currentGame),
        });
        let updateResult = await res.json();
        return updateResult;
      }
          
    </script>
  </body>
</html>